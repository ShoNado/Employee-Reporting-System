# Telegram Bot на Go

Telegram бот на Go с использованием SQLite для хранения данных пользователей и управления доступом.

## Возможности

- Сохранение информации о пользователях в SQLite базу данных:
  - Username
  - Имя
  - Фамилия
  - Номер телефона
  - Статус (админ/обычный пользователь)
- Управление доступом через систему ролей
- Логирование действий пользователей
- Настройка администраторов через конфиг-файл
- Защита от неавторизованного доступа
- Дублирование информации о загрузке файлов в Google Sheets

## Требования

- Go 1.21 или выше
- SQLite3
- MongoDB
- Telegram Bot Token
- Google Sheets API credentials

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone [URL репозитория]
   cd [название директории]
   ```

2. Установите зависимости:
   ```bash
   go mod tidy
   ```

## Настройка

1. Создайте файл `config/config.json` со следующим содержимым:
   ```json
   {
     "bot_token": "YOUR_BOT_TOKEN_HERE",
     "mongo_uri": "mongodb://localhost:27017",
     "admins": {
       "admin_username": true
     }
   }
   ```

2. Замените `YOUR_BOT_TOKEN_HERE` на токен вашего бота
3. Добавьте username'ы администраторов в список `admins`

### Настройка Google Sheets API

1. Создайте проект в [Google Cloud Console](https://console.cloud.google.com/)
2. Включите Google Sheets API для проекта
3. Создайте учетные данные OAuth 2.0
4. Скачайте JSON-файл с учетными данными и сохраните его как `config/credentials.json`
5. При первом запуске бота следуйте инструкциям для авторизации

## Запуск

```bash
go run cmd/bot/main.go
```

## Структура проекта

```
.
├── cmd/
│   └── bot/
│       └── main.go         # Точка входа приложения
├── config/
│   ├── config.json        # Конфигурационный файл
│   └── credentials.json   # Учетные данные Google API
├── db/
│   └── database.go        # Работа с базой данных
├── internal/
│   ├── bot.go            # Основная логика бота
│   └── sheets.go         # Интеграция с Google Sheets
├── models/
│   └── user.go           # Модели данных
├── go.mod                # Зависимости Go
└── README.md            # Документация
```

## Получение токена бота

1. Откройте Telegram и найдите [@BotFather](https://t.me/botfather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания нового бота
4. После создания бота вы получите токен
5. Скопируйте токен в файл `config/config.json`

## Администрирование

### Добавление администратора

1. Откройте файл `config/config.json`
2. Добавьте username администратора в список `admins`:
   ```json
   "admins": {
     "username1": true,
     "username2": true
   }
   ```

### Права администратора

- Доступ ко всем командам бота
- Управление пользователями
- Просмотр статистики

## Интеграция с Google Sheets

Бот автоматически дублирует информацию о загружаемых файлах в Google Sheets. Для каждого файла записывается:

- ID файла
- ID пользователя
- Имя пользователя
- Имя файла
- Тип файла
- Размер файла
- Дата и время загрузки
- Статус файла (Активен/Удален)

При удалении файла через команды `/delete` или `/deleteall`, статус файла в таблице автоматически обновляется на "Удален".

Таблица доступна по ссылке: [Google Sheets](https://docs.google.com/spreadsheets/d/13KIfRMTePI4djpi6W4pm6WKaE0I9sTA4-LPkesS724I/edit?usp=sharing)

## Безопасность

- Все данные пользователей хранятся в локальной SQLite базе данных
- Доступ к административным функциям ограничен списком администраторов
- Токен бота хранится в конфигурационном файле

## Лицензия

MIT 